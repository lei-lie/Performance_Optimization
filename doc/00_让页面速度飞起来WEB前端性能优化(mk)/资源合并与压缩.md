## 目标

* 理解减少`HTTP`请求数量和减少请求资源大小两个优化要点
* 掌握压缩与合并的原理
* 掌握通过在线网站和[fis3](http://fis.baidu.com/)两种方式实现压缩与合并的方法

## WEB前端

web前端本质上是一种GUI软件，是一种BS架构的GUI软件

### CS架构GUI软件的开发与部署过程

开发者开发GUI软件相关的代码

然后通过发布，把开发代码打成一个包，发布到对应的应用平台

运行：到对应的应用平台下载安装包，运行安装包

在本地有一份资源，用户访问的就是本地的资源

### BS架构GUI软件的开发与部署过程

开发者开发`GUI`软件代码

将代码发布到远程服务器`CND`或者`wbserver`上

运行过程：

用户打开浏览输入网址，浏览器请远程服务器上的资源呈现给用户

### 浏览器的一个请求从发送到返回都经历了什么？

![从输入URL到数据返回都经历了什么？](D:\00_workspace\00_mine\Performance_Optimization\doc\00_让页面速度飞起来WEB前端性能优化(mk)\从输入URL到数据返回都经历了什么？.png)

这一个过程中存在的性能优化点-减少请求时间

* `DNS`
  * 浏览器层面(`link`标签的`ref`属性设置为`dns-prefetch`)，路由器层面将相关的`DNS`服务器进行缓存,减少`DNS`的访问时间
* 网络请求过程
  * 涉及带宽，网络的选择，缓存
    * 使用`CND`解决网络选择和缓存的问题，`CDN`是请求静态资源用的，对于静态资源来说请求中携带的`cookie`是没用的,应该将`HTTP`请求头中携带的`cookie`去掉，但是实际工作中`CDN`的域名可能和主站的域名相同，导致通过`CDN`请求静态资源时会将主站`HTTP`请求携带的`cookie`携带过去，造成带宽的损耗，所以`CDN`的域名要和主站的域名区分开
    * 浏览器的缓存策略缓存接口





## 请求的过程及潜在的性能优化点

* `DNS`是否可以通过缓存减少`DNS`查询时间？
* 网络请求的过程走最近的网络环境？
* 相同的静态资源是否可以缓存？
* 能够减少`HTTP`其你去大小？
* 减少`HTTP` 请求
* 服务端渲染

深入理解(基于现有业务，技术栈)`HTTP`请求过程是前端性能优化的核心

## 资源的合并与压缩

涉及的优化点：

* 减少`HTTP`请求数量 -- 资源的合并
* 减少请求资源的大小 -- 资源的压缩

涉及的压缩与合并

* `HTML`压缩
* `CSS`压缩
* `JS`的压缩和混乱
* 文件合并
* 开启`Gzip`

### HTML压缩

压缩在文档中有意义，但是在HTML中不显示的字符，包括空格、制表符、换行符等，以及一些其他意义的字符例如HTML注释可以可被压缩

#### HTML压缩方式

* 使用在线网站进行压缩
* `nodejs`提供了[html-minifier](https://www.npmjs.com/package/html-minifier)工具
* 后端模板引擎渲染压缩 -- 服务端渲染压缩

### CSS压缩

* 无效代码删除
* `CSS`语义合并

#### CSS压缩方式

* 使用在线网站进行压缩
* 使用[html-minifier](https://www.npmjs.com/package/html-minifier)对`HTML`中的`CSS`进行压缩
* 使用[clean-css](https://www.npmjs.com/package/clean-css)对`css`进行压缩



### JS压缩与混乱

* 无效字符的删除
* 剔除注释
* 代码语义的压缩与优化，例如将长变量名缩短长度
* 代码保护

#### JS压缩的方式

* 使用在线网站进行压缩
* 使用[html-minifier](https://www.npmjs.com/package/html-minifier)对HTML中的JS进行压缩
* 使用[uglifyjs 3.x](https://github.com/mishoo/UglifyJS/tree/v3.6.1)进行压缩

### 文件合并

#### 合并文件存在的问题

* 首屏渲染问题 -- 合并后文件体积变大，现代化前端框架`Vue,React`
* 缓存失效问题

#### 文件合并建议

* 公共库合并，公共库单独打包成一个文件，业务代码单独打一个包，不让业务代码影响公共库
* 不同页面的合并，针对单页应用，针对页面来打包，只有路由到的页面采取加载自己需要的资源文件
* 见机行事，随机应变

#### 文件合并的方式

* 使用在线网站进行文件合并
* 使用`node.js`实现文件合并,例如`webpack`,`gulp`,`fis3`

### 开启Gzip

## 资源压缩与合并实战

### 在线工具压缩

#### 新闻列表页面实战开发

* 页面代码开发
* 使用[在线网站](https://tool.oschina.net/jscompress)进行压缩与合并
* 使用[fis3](http://fis.baidu.com/)进行自动化的压缩与合并



